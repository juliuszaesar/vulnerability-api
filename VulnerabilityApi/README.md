# Vulnerability API

This project is a ASPNET Core Web API for managing vulnerabilities. It uses MySQL as the database, Entity Framework Core as ORM and includes Docker configuration for "easy" setup and deployment.

## Prerequisites

- [.NET 8.0 SDK](https://dotnet.microsoft.com/download/dotnet/8.0) 
- [Docker](https://www.docker.com/products/docker-desktop)
- [Docker Compose](https://docs.docker.com/compose/install/)

## Getting Started

1. Clone the repository:
   ```
   git clone https://github.com/juliuszaesar/vulnerability-api.git
   ```

2. Start the MySQL database and Adminer using Docker Compose:
   ```
   docker-compose up -d
   ```

3. Ports and login:
   ```
   Database: 3333
   Adminer database management (UI): 8585
   MYSQL_DATABASE: vulnerabilitydb 
   MYSQL_USER: mysql
   MYSQL_PASSWORD: secretpassword
   ```

4. Apply Entity Framework migration to the database:
```
dotnet ef database update 20240825183211_AddingDto
```
5. Run the API:
   ```
   dotnet run
   ```

The API will be available at `http://localhost:5238`.
Swagger is available at: `http://localhost:5238/swagger/index.html`

## Features

- JWT Authentication
- Swagger UI for API documentation and testing
- MySQL database integration
- In-memory database for testing
- Docker support for easy database setup

## API Documentation
### Authentication

The API uses JWT (JSON Web Token) for authentication. To access protected endpoints:

1. First register a user via **/auth/register** endpoint, provide this information:
```json
{
  "username": "string",
  "password": "string",
  "email": "string"
}
```
2. Obtain a token from the authentication endpoint, **/auth/login**
```json
{
  "username": "string",
  "password": "string"
}
```
3. Include the token in the `Authorization` header of your requests:
   ```
   Authorization: Bearer <your-token>
   ```
Or via Swagger Web UI by pressing Authorize-button (top right), and enter "Bearer <your-token>"
### Database Management

- The MySQL database is exposed on port ```3333```.
- Adminer is available at `http://localhost:8585` for database management.
    - Server: mysql
    - Username: mysql
    - Password: secretpassword
    - Database: vulnerabilitydb

## Testing

The project is configured to use an in-memory database for testing. Although the integration test currently 
is not working as expected when authentication is enabled, therefore make sure to **disable** authentication first:
1. Comment out these two lines ```app.UseAuthentication();
app.UseAuthorization();``` in **Program.cs**. 
2. Comment out ```[Authorize]``` in **VulnerabilitiesController.cs**
3. Then to run tests:

```
dotnet test
```

## Configuration

Key configuration settings can be set here if you don't want to use default (unsafe) values:

- JWT settings in `appsettings.json`:
  ```json
  "Jwt": {
    "Key": "<your-secret-key>",
    "Issuer": "<your-issuer>",
    "Audience": "<your-audience>"
  }
  ```

## Docker

The `docker-compose.yml` file includes configurations for:
- MySQL database
- Adminer for database management

To start the Docker containers:
```
docker compose up -d
```

To stop the containers:
```
docker compose down
```